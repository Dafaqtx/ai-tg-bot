import {
  hasMarkdownIssues,
  escapeMarkdown,
} from "../../src/utils/telegramUtils";

describe("TelegramUtils", () => {
  describe("hasMarkdownIssues", () => {
    it("Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð¾Ð±Ð½Ð°Ñ€ÑƒÐ¶Ð¸Ð²Ð°Ñ‚ÑŒ Ð½ÐµÑÐ±Ð°Ð»Ð°Ð½ÑÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ Ð·Ð²ÐµÐ·Ð´Ð¾Ñ‡ÐºÐ¸", () => {
      expect(hasMarkdownIssues("Ð­Ñ‚Ð¾ *Ð½ÐµÑÐ±Ð°Ð»Ð°Ð½ÑÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ Ñ‚ÐµÐºÑÑ‚")).toBe(true);
      expect(hasMarkdownIssues("Ð­Ñ‚Ð¾ *Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ð¹* Ñ‚ÐµÐºÑÑ‚")).toBe(false);
    });

    it("Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð¾Ð±Ð½Ð°Ñ€ÑƒÐ¶Ð¸Ð²Ð°Ñ‚ÑŒ Ð½ÐµÑÐ±Ð°Ð»Ð°Ð½ÑÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ Ð¿Ð¾Ð´Ñ‡ÐµÑ€ÐºÐ¸Ð²Ð°Ð½Ð¸Ñ", () => {
      expect(hasMarkdownIssues("Ð­Ñ‚Ð¾ _Ð½ÐµÑÐ±Ð°Ð»Ð°Ð½ÑÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ Ñ‚ÐµÐºÑÑ‚")).toBe(true);
      expect(hasMarkdownIssues("Ð­Ñ‚Ð¾ _Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ð¹_ Ñ‚ÐµÐºÑÑ‚")).toBe(false);
    });

    it("Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð¾Ð±Ð½Ð°Ñ€ÑƒÐ¶Ð¸Ð²Ð°Ñ‚ÑŒ Ð½ÐµÐ·Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ Ð¾Ð±Ñ€Ð°Ñ‚Ð½Ñ‹Ðµ ÐºÐ°Ð²Ñ‹Ñ‡ÐºÐ¸", () => {
      expect(hasMarkdownIssues("ÐšÐ¾Ð´ `Ð½ÐµÐ·Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ð¹")).toBe(true);
      expect(hasMarkdownIssues("ÐšÐ¾Ð´ `Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ð¹`")).toBe(false);
    });

    it("Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð¾Ð±Ð½Ð°Ñ€ÑƒÐ¶Ð¸Ð²Ð°Ñ‚ÑŒ Ð½ÐµÐ·Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ ÑÐºÐ¾Ð±ÐºÐ¸", () => {
      expect(hasMarkdownIssues("Ð¡ÑÑ‹Ð»ÐºÐ° [Ð½ÐµÐ·Ð°ÐºÑ€Ñ‹Ñ‚Ð°Ñ")).toBe(true);
      expect(hasMarkdownIssues("Ð¡ÑÑ‹Ð»ÐºÐ° (Ð½ÐµÐ·Ð°ÐºÑ€Ñ‹Ñ‚Ð°Ñ")).toBe(true);
      expect(hasMarkdownIssues("Ð¡ÑÑ‹Ð»ÐºÐ° [Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð°Ñ](url)")).toBe(false);
    });

    it("Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°Ñ‚ÑŒ false Ð´Ð»Ñ Ð¾Ð±Ñ‹Ñ‡Ð½Ð¾Ð³Ð¾ Ñ‚ÐµÐºÑÑ‚Ð°", () => {
      expect(hasMarkdownIssues("ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ð¹ Ñ‚ÐµÐºÑÑ‚ Ð±ÐµÐ· Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ")).toBe(false);
      expect(hasMarkdownIssues("Ð¢ÐµÐºÑÑ‚ Ñ ÑÐ¼Ð¾Ð´Ð¶Ð¸ ðŸš€ Ð¸ Ñ‡Ð¸ÑÐ»Ð°Ð¼Ð¸ 123")).toBe(false);
    });
  });

  describe("escapeMarkdown", () => {
    it("Ð´Ð¾Ð»Ð¶ÐµÐ½ ÑÐºÑ€Ð°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð·Ð²ÐµÐ·Ð´Ð¾Ñ‡ÐºÐ¸", () => {
      expect(escapeMarkdown("Ð¢ÐµÐºÑÑ‚ Ñ * Ð·Ð²ÐµÐ·Ð´Ð¾Ñ‡ÐºÐ¾Ð¹")).toBe(
        "Ð¢ÐµÐºÑÑ‚ Ñ \\* Ð·Ð²ÐµÐ·Ð´Ð¾Ñ‡ÐºÐ¾Ð¹"
      );
    });

    it("Ð´Ð¾Ð»Ð¶ÐµÐ½ ÑÐºÑ€Ð°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿Ð¾Ð´Ñ‡ÐµÑ€ÐºÐ¸Ð²Ð°Ð½Ð¸Ñ", () => {
      expect(escapeMarkdown("Ð¢ÐµÐºÑÑ‚ Ñ _ Ð¿Ð¾Ð´Ñ‡ÐµÑ€ÐºÐ¸Ð²Ð°Ð½Ð¸ÐµÐ¼")).toBe(
        "Ð¢ÐµÐºÑÑ‚ Ñ \\_ Ð¿Ð¾Ð´Ñ‡ÐµÑ€ÐºÐ¸Ð²Ð°Ð½Ð¸ÐµÐ¼"
      );
    });

    it("Ð´Ð¾Ð»Ð¶ÐµÐ½ ÑÐºÑ€Ð°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¾Ð±Ñ€Ð°Ñ‚Ð½Ñ‹Ðµ ÐºÐ°Ð²Ñ‹Ñ‡ÐºÐ¸", () => {
      expect(escapeMarkdown("ÐšÐ¾Ð´ Ñ ` ÐºÐ°Ð²Ñ‹Ñ‡ÐºÐ¾Ð¹")).toBe("ÐšÐ¾Ð´ Ñ \\` ÐºÐ°Ð²Ñ‹Ñ‡ÐºÐ¾Ð¹");
    });

    it("Ð´Ð¾Ð»Ð¶ÐµÐ½ ÑÐºÑ€Ð°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÐºÐ²Ð°Ð´Ñ€Ð°Ñ‚Ð½Ñ‹Ðµ ÑÐºÐ¾Ð±ÐºÐ¸", () => {
      expect(escapeMarkdown("[Ð¢ÐµÐºÑÑ‚] Ð² ÑÐºÐ¾Ð±ÐºÐ°Ñ…")).toBe("\\[Ð¢ÐµÐºÑÑ‚\\] Ð² ÑÐºÐ¾Ð±ÐºÐ°Ñ…");
    });

    it("Ð´Ð¾Ð»Ð¶ÐµÐ½ ÑÐºÑ€Ð°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÐºÑ€ÑƒÐ³Ð»Ñ‹Ðµ ÑÐºÐ¾Ð±ÐºÐ¸", () => {
      expect(escapeMarkdown("(Ð¢ÐµÐºÑÑ‚) Ð² ÑÐºÐ¾Ð±ÐºÐ°Ñ…")).toBe("\\(Ð¢ÐµÐºÑÑ‚\\) Ð² ÑÐºÐ¾Ð±ÐºÐ°Ñ…");
    });

    it("Ð´Ð¾Ð»Ð¶ÐµÐ½ ÑÐºÑ€Ð°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¾ ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð² Ð¾Ð´Ð½Ð¾Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ð¾", () => {
      const input = "Ð¢ÐµÐºÑÑ‚ Ñ *Ð¶Ð¸Ñ€Ð½Ñ‹Ð¼*, _ÐºÑƒÑ€ÑÐ¸Ð²Ð¾Ð¼_ Ð¸ `ÐºÐ¾Ð´Ð¾Ð¼`";
      const expected = "Ð¢ÐµÐºÑÑ‚ Ñ \\*Ð¶Ð¸Ñ€Ð½Ñ‹Ð¼\\*, \\_ÐºÑƒÑ€ÑÐ¸Ð²Ð¾Ð¼\\_ Ð¸ \\`ÐºÐ¾Ð´Ð¾Ð¼\\`";
      expect(escapeMarkdown(input)).toBe(expected);
    });

    it("Ð½Ðµ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð¸Ð·Ð¼ÐµÐ½ÑÑ‚ÑŒ Ð¾Ð±Ñ‹Ñ‡Ð½Ñ‹Ð¹ Ñ‚ÐµÐºÑÑ‚ Ð±ÐµÐ· ÑÐ¿ÐµÑ†ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð²", () => {
      const text = "ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ð¹ Ñ‚ÐµÐºÑÑ‚";
      expect(escapeMarkdown(text)).toBe(text);
    });

    it("Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð¾Ð±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°Ñ‚ÑŒ Ñ‚ÐµÐºÑÑ‚ Ñ ÑÐ¼Ð¾Ð´Ð¶Ð¸", () => {
      const text = "Ð¢ÐµÐºÑÑ‚ Ñ ÑÐ¼Ð¾Ð´Ð¶Ð¸ ðŸš€";
      expect(escapeMarkdown(text)).toBe(text);
    });

    it("Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð¾Ð±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°Ñ‚ÑŒ Ð¿ÑƒÑÑ‚ÑƒÑŽ ÑÑ‚Ñ€Ð¾ÐºÑƒ", () => {
      expect(escapeMarkdown("")).toBe("");
    });
  });
});
